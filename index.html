<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login Panel</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    header, footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #f0f0f0;
    }
    .form-group, .info-group, .links {
      margin: 20px auto;
      max-width: 400px;
      text-align: left;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
    }
    .loading {
      display: none;
    }
    @media screen and (max-width: 600px) {
      header, footer {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

<header>
  <img src="logo.png" alt="Logo" width="50"/>
  <h2>Login Portal</h2>
</header>

<div class="form-group" id="loginForm">
  <input type="text" id="username" placeholder="Username" />
  <input type="password" id="password" placeholder="Password" />
  <input type="text" id="ceu" placeholder="CEU Number" />
  <button onclick="validateLogin()">Login</button>
  <img id="loading1" class="loading" src="loading.gif" width="30" />
  <p id="errorMsg" style="color:red;"></p>
</div>

<div class="info-group" id="infoForm" style="display:none;">
  <input type="text" id="firstname" placeholder="First Name" />
  <input type="text" id="lastname" placeholder="Last Name" />
  <input type="text" id="nationality" placeholder="Nationality" />
  <input type="text" id="passport" placeholder="Passport/ID Number" />
  <input type="text" id="caseNumber" placeholder="Case Number" />
  <button onclick="validatePersonal()">Continue</button>
  <img id="loading2" class="loading" src="loading.gif" width="30" />
  <p id="errorMsg2" style="color:red;"></p>
</div>

<div class="links" id="linksPanel" style="display:none;">
  <button id="link1"></button>
  <button id="link2"></button>
  <button id="link3"></button>
  <button id="link4"></button>
  <button id="link5"></button>
</div>

<footer>
  <img src="logo.png" alt="Logo" width="40" />
  <h4>Official Portal</h4>
</footer>

<script>
let currentUser = null;
let userData = [];

fetch("data.json")
  .then(response => response.json())
  .then(data => userData = data);

function showLoading(id) {
  document.getElementById(id).style.display = "inline-block";
  return new Promise(res => setTimeout(res, 5000));
}

async function validateLogin() {
  document.getElementById("errorMsg").innerText = "";
  await showLoading("loading1");
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  const ceu = document.getElementById("ceu").value;

  const match = userData.find(u => u.username === username && u.password === password && u.ceu === ceu);

  document.getElementById("loading1").style.display = "none";

  if (match) {
    currentUser = match;
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("infoForm").style.display = "block";
  } else {
    document.getElementById("errorMsg").innerText = "Invalid credentials.";
  }
}

async function validatePersonal() {
  document.getElementById("errorMsg2").innerText = "";
  await showLoading("loading2");

  const fname = document.getElementById("firstname").value;
  const lname = document.getElementById("lastname").value;
  const nat = document.getElementById("nationality").value;
  const pass = document.getElementById("passport").value;
  const caseNum = document.getElementById("caseNumber").value;

  document.getElementById("loading2").style.display = "none";

  if (
    fname === currentUser.firstname &&
    lname === currentUser.lastname &&
    nat === currentUser.nationality &&
    pass === currentUser.passport &&
    caseNum === currentUser.caseNumber
  ) {
    document.getElementById("infoForm").style.display = "none";
    document.getElementById("linksPanel").style.display = "block";

    for (let i = 1; i <= 5; i++) {
      const btn = document.getElementById("link" + i);
      btn.innerText = "Document " + i;
      btn.onclick = () => {
        // باز کردن بدون تب جدید
        fetch(currentUser["link" + i])
          .then(() => window.location.href = currentUser["link" + i]);
      };
    }
  } else {
    document.getElementById("errorMsg2").innerText = "Personal info doesn't match.";
  }
}
</script>

</body>
</html>
